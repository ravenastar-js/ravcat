const inquirer = require("inquirer");
const { colors } = require("../config/colors");
const HeaderRenderer = require("../renderer/header");
const MenuRenderer = require("../renderer/menu");
const BoxRenderer = require("../renderer/box");
const VirusTotalLoader = require("../data/virustotal-loader");
const figlet = require("figlet");

/**
 * üéÆ Controla todos os menus e navega√ß√£o do sistema
 * @class Menu
 */
class Menu {
  constructor() {
    this.header = new HeaderRenderer();
    this.boxRenderer = new BoxRenderer();
    this.vtLoader = new VirusTotalLoader();
    this.companies = null;
  }

  /**
   * üéØ Exibe o menu principal com todas as op√ß√µes
   * @async
   * @method display
   * @param {Object} companies
   * @returns {Promise<void>}
   */
  async display(companies) {
    this.companies = companies;
    await this.showMainMenu();
  }

  /**
   * üè† Mostra o menu principal com cabe√ßalho
   * @async
   * @method showMainMenu
   * @returns {Promise<void>}
   */
  async showMainMenu() {
    while (true) {
      this.header.displayHeader();

      const { action } = await inquirer.prompt([
        {
          type: "list",
          name: "action",
          prefix: "",
          message: colors.highlight2("üéØ Menu Principal - O que deseja fazer?"),
          choices: MenuRenderer.createMainMenu(),
          pageSize: 10,
          loop: false,
        },
      ]);

      switch (action) {
        case "companies_menu":
          await this.showCompaniesMenu();
          break;
        case "virustotal_fp":
          await this.showVirusTotalFP();
          break;
        case "quick_report":
          await this.showQuickReport();
          break;
        case "about":
          await this.showAbout();
          break;
        case "exit":
          this.showGoodbye();
          return;
      }
    }
  }

  /**
   * üì¨ Mostra menu espec√≠fico de empresas e servi√ßos
   * @async
   * @method showCompaniesMenu
   * @returns {Promise<void>}
   */
  async showCompaniesMenu() {
    this.header.displayHeader();

    const { action } = await inquirer.prompt([
      {
        type: "list",
        name: "action",
        prefix: "",
        message: colors.highlight2("üéØ O que deseja fazer?"),
        choices: MenuRenderer.createVTMenu()
      }
    ]);

    switch (action) {
      case "list_all":
        await this.showCompaniesList();
        break;
      case "search_company":
        await this.searchCompany();
        break;
      case "generate_txt":
        await this.generateTxtList();
        break;
      case "menu":
        return;
      case "exit":
        this.showGoodbye();
        process.exit(0);
    }
  }

  /**
   * üõ°Ô∏è Mostra contatos para falsos positivos do VirusTotal
   * @async
   * @method showVirusTotalFP
   * @returns {Promise<void>}
   */
  async showVirusTotalFP() {
    this.header.displayHeader();

    try {
      const vtData = await this.vtLoader.loadData();
      const vendors = Object.keys(vtData.companies).sort();

      const bannerText = figlet.textSync("VIRUSTOTAL", {
        font: "Standard",
        horizontalLayout: "default",
        verticalLayout: "default",
      });

      let vtContent = [
        "",
        colors.action(bannerText),
        "",
        colors.primary("üõ°Ô∏è CONTATOS PARA FALSOS POSITIVOS"),
        "",
        colors.text("üîó Fonte: ") + colors.link(vtData.source),
        "",
        colors.success(`üìã TOTAL DE VENDORS: ${vendors.length}`),
        "",
        colors.text("üéØ Escolha uma op√ß√£o abaixo:"),
        "",
      ].join("\n");

      const vtBox = this.boxRenderer.createBox(vtContent, {
        float: "left",
        padding: 1,
        margin: 1,
        borderColor: "#57f287",
        borderStyle: "classic",
        backgroundColor: "#1a1a1a",
        width: Math.min(this.terminalWidth - 8, 80),
        textAlignment: "center",
      });

      console.log(vtBox);
      console.log("");

      const { action } = await inquirer.prompt([
        {
          type: "list",
          name: "action",
          prefix: "",
          message: colors.highlight2("üéØ O que deseja fazer?"),
          choices: MenuRenderer.createVTMenu()
        }
      ]);

      switch (action) {
        case "list_all":
          await this.showVTVendorsList(vtData.companies);
          break;
        case "search_vendor":
          await this.searchVTVendor(vtData.companies);
          break;
        case "generate_txt":
          await this.generateVTTxt(vtData);
          break;
        case "menu":
          return;
        case "exit":
          this.showGoodbye();
          process.exit(0);
      }
    } catch (error) {
      const fallbackContent = [
        "",
        colors.primary("üõ°Ô∏è CONTATOS PARA FALSOS POSITIVOS"),
        "",
        colors.text("üîó Fonte: ") + colors.link("https://docs.virustotal.com/docs/false-positive-contacts"),
        "",
        colors.warning("‚ö†Ô∏è  IMPORTANTE:"),
        colors.text("‚Ä¢ VirusTotal apenas agrega dados de diversos vendors"),
        colors.text("‚Ä¢ Entre em contato com o vendor espec√≠fico que est√° gerando o falso positivo"),
        colors.text("‚Ä¢ Inclua o link do relat√≥rio do VirusTotal na sua solicita√ß√£o"),
        "",
      ].join("\n");

      const fallbackBox = this.boxRenderer.createBox(fallbackContent, {
        float: "left",
        padding: 1,
        margin: 1,
        borderColor: "#57f287",
        borderStyle: "classic",
        backgroundColor: "#1a1a1a",
        width: Math.min(this.terminalWidth - 8, 80),
        textAlignment: "left",
      });

      console.log(fallbackBox);
      console.log("");

      await inquirer.prompt([
        {
          type: "input",
          name: "continue",
          message: colors.muted("Pressione Enter para continuar..."),
        },
      ]);
    }
  }
  /**
   * üö® Mostra op√ß√µes de den√∫ncia r√°pida para casos urgentes
   * @async
   * @method showQuickReport
   * @returns {Promise<void>}
   */
  async showQuickReport() {
    this.header.displayHeader();

    const quickReports = [
      {
        name: "üåê SaferNet - Den√∫ncias An√¥nimas",
        description: "Den√∫ncias de crimes contra direitos humanos na internet",
        contacts: [
          {
            type: "website",
            contact: "https://new.safernet.org.br/denuncie#",
            description: "Formul√°rio online an√¥nimo"
          }
        ]
      },
      {
        name: "üë∂ N√∫cleo de Observa√ß√£o e An√°lise Digital (NOAD)",
        description: "Crimes virtuais contra crian√ßas e adolescentes",
        contacts: [
          {
            type: "email",
            contact: "nucleo.noad@sp.gov.br",
            description: "E-mail de den√∫ncia"
          }
        ]
      }
    ];

    const { selectedReport } = await inquirer.prompt([
      {
        type: "list",
        name: "selectedReport",
        prefix: "",
        message: colors.highlight2("üö® Selecione o tipo de den√∫ncia r√°pida:"),
        choices: [
          ...quickReports.map((report, index) => ({
            name: `${report.name}\n     ${colors.muted(report.description)}`,
            value: index,
            short: report.name
          })),
          ...MenuRenderer.createFooter()
        ],
        pageSize: 10,
        loop: false,
      }
    ]);

    switch (selectedReport) {
      case "menu":
        return;
      case "exit":
        this.showGoodbye();
        process.exit(0);
      default:
        if (typeof selectedReport === 'number' && quickReports[selectedReport]) {
          await this.showQuickReportDetails(quickReports[selectedReport]);
        }
    }
  }

  /**
   * üìÑ Mostra detalhes de uma den√∫ncia r√°pida
   * @async
   * @method showQuickReportDetails
   * @param {Object} report
   * @returns {Promise<void>}
   */
  async showQuickReportDetails(report) {
    this.header.displayHeader();

    let contentLines = [];

    contentLines.push(colors.title(`üö® ${report.name}`));
    contentLines.push(colors.muted('‚îÄ'.repeat(50)));
    contentLines.push('');
    contentLines.push(colors.text(report.description));
    contentLines.push('');
    contentLines.push(colors.subtitle("üìû Contatos para Den√∫ncia:"));
    contentLines.push('');

    report.contacts.forEach((contact, index) => {
      const icon = contact.type === 'email' ? 'üìß' :
        contact.type === 'phone' ? 'üìû' : 'üåê';

      contentLines.push(colors.text(`  ${icon} ${index + 1}. ${contact.description}`));
      contentLines.push(colors.contact(`     ${contact.contact}`));
      contentLines.push('');
    });

    contentLines.push(colors.muted('‚îÄ'.repeat(50)));
    contentLines.push(colors.highlight2('üí° Para emerg√™ncias, ligue 190 (Pol√≠cia) ou 100 (Direitos Humanos)'));

    const content = contentLines.join('\n');

    const reportBox = this.boxRenderer.createBox(content, {
      float: "left",
      padding: 1,
      margin: 1,
      borderColor: "#57f287",
      borderStyle: "classic",
      backgroundColor: "#1a1a1a",
      width: Math.min(this.terminalWidth - 8, 70),
      textAlignment: "left",
    });

    console.log(reportBox);
    console.log('');

    const { action } = await inquirer.prompt([
      {
        type: "list",
        name: "action",
        prefix: "",
        message: colors.highlight2("üéØ O que deseja fazer agora?"),
        choices: [
          {
            name: `${colors.danger("üö®")} Ver outra den√∫ncia r√°pida`,
            value: "another",
            short: "Outra den√∫ncia"
          },
          ...MenuRenderer.createFooter()
        ],
      }
    ]);

    switch (action) {
      case "another":
        await this.showQuickReport();
        break;
      case "menu":
        return;
      case "exit":
        this.showGoodbye();
        process.exit(0);
    }
  }


  /**
   * üìã Mostra lista completa de vendors do VirusTotal
   * @async
   * @method showVTVendorsList
   * @param {Object} vendors
   * @returns {Promise<void>}
   */
  async showVTVendorsList(vendors) {
    const vendorList = Object.keys(vendors).sort();

    this.header.displayHeader();

    console.log(colors.text.bold("\nüìã LISTA COMPLETA DE VENDORS - VIRUSTOTAL"));
    console.log(`üìä Total: ${colors.highlight2(vendorList.length)} vendors dispon√≠veis\n`);

    const { selectedVendor } = await inquirer.prompt([
      {
        type: "list",
        name: "selectedVendor",
        prefix: "",
        message: colors.highlight2("üéØ Selecione um vendor:"),
        choices: [
          ...vendorList.map(vendorName => {
            const vendor = vendors[vendorName];
            const icon = this.getVTCompanyIcon(vendor.type);
            return {
              name: `${icon} ${vendorName} - ${colors.muted(this.getVTTypeDescription(vendor.type))}`,
              value: vendorName
            };
          }),
          ...MenuRenderer.createFooter()
        ],
        pageSize: Math.min(vendorList.length + 4, 15),
        loop: false,
      }
    ]);

    switch (selectedVendor) {
      case "menu":
        return;
      case "exit":
        this.showGoodbye();
        process.exit(0);
      default:
        await this.showVTVendorDetails(selectedVendor, vendors[selectedVendor]);
    }
  }

  /**
   * üîç Permite buscar vendor por nome
   * @async
   * @method searchVTVendor
   * @param {Object} vendors
   * @returns {Promise<void>}
   */
  async searchVTVendor(vendors) {
    this.header.displayHeader();

    const { vendorName } = await inquirer.prompt([
      {
        type: "input",
        name: "vendorName",
        message: colors.title("üîç Digite o nome do vendor:"),
        validate: (input) => {
          if (input.trim().length === 0) {
            return colors.danger("‚ö†Ô∏è  Por favor, digite um nome v√°lido");
          }
          return true;
        },
      },
    ]);

    const searchTerm = vendorName.toLowerCase().trim();
    const foundVendor = this.findVTVendor(searchTerm, vendors);

    if (foundVendor) {
      await this.showVTVendorDetails(foundVendor.key, foundVendor.vendor);
    } else {
      console.log(colors.error(`\n‚ùå Vendor "${vendorName}" n√£o encontrado.`));
      console.log(colors.highlight2("üí° Use a lista completa para ver todas as op√ß√µes dispon√≠veis\n"));

      const { tryAgain } = await inquirer.prompt([
        {
          type: "confirm",
          name: "tryAgain",
          message: colors.title("üîç Deseja tentar outra busca?"),
          default: true,
        },
      ]);

      if (tryAgain) {
        await this.searchVTVendor(vendors);
      } else {
        await this.showVirusTotalFP();
      }
    }
  }

  /**
   * üîé Encontra vendor baseado no termo de busca
   * @method findVTVendor
   * @param {string} searchTerm
   * @param {Object} vendors
   * @returns {Object|null}
   */
  findVTVendor(searchTerm, vendors) {
    const vendorNames = Object.keys(vendors);

    if (vendors[searchTerm]) {
      return { key: searchTerm, vendor: vendors[searchTerm] };
    }

    for (const vendorName of vendorNames) {
      if (vendorName.toLowerCase().includes(searchTerm)) {
        return { key: vendorName, vendor: vendors[vendorName] };
      }
    }

    return null;
  }

  /**
   * üìÑ Gera arquivo TXT com lista de vendors
   * @async
   * @method generateVTTxt
   * @param {Object} vtData
   * @returns {Promise<void>}
   */
  async generateVTTxt(vtData) {
    this.header.displayHeader();

    console.log(colors.text("üìÑ Preparando para gerar arquivo TXT do VirusTotal...\n"));

    try {
      const VTTxtGenerator = require("../utils/vt-txt-generator");
      const txtGenerator = new VTTxtGenerator(vtData);
      const result = txtGenerator.generateTxtFile();

      if (result.success) {
        console.log(colors.success("‚úÖ Arquivo TXT do VirusTotal gerado com sucesso!\n"));

        console.log(colors.primary("üìÅ INFORMA√á√ïES DO ARQUIVO"));
        console.log(colors.text("  üìÑ Nome: ") + colors.text(result.fileName));
        console.log(colors.text("  üìÇ Local: ") + colors.link(result.filePath));
        console.log(colors.text("  üíæ Tamanho: ") + colors.text(this.getFileSize(result.filePath) + "\n"));

        console.log(colors.primary("üìä CONTE√öDO INCLU√çDO NO ARQUIVO"));
        console.log(colors.text("  üõ°Ô∏è ") + colors.description("Cabe√ßalho completo") + colors.text(" - Informa√ß√µes do VirusTotal"));
        console.log(colors.text("  üìã ") + colors.description("Lista de vendors") + colors.text(" - Organizados alfabeticamente"));
        console.log(colors.text("  üìß ") + colors.description("Contatos por vendor") + colors.text(" - E-mails e formul√°rios"));

        console.log(colors.highlight2("üí° O arquivo est√° pronto para uso..."));

      } else {
        console.log(colors.error("‚ùå " + "‚ïê".repeat(45)));
        console.log(colors.error("üí• ERRO AO GERAR ARQUIVO"));
        console.log(colors.error("‚ùå " + "‚ïê".repeat(45) + "\n"));

        console.log(colors.text("üìù Detalhes do erro:"));
        console.log(colors.error(`  ${result.error}\n`));
      }
    } catch (error) {
      console.log(colors.error(`‚ùå Erro inesperado: ${error.message}\n`));
    }

    await inquirer.prompt([
      {
        type: "input",
        name: "continue",
        message: colors.muted("Pressione Enter para continuar..."),
      },
    ]);

    await this.showVirusTotalFP();
  }

  /**
   * üìÑ Mostra detalhes completos de um vendor
   * @async
   * @method showVTVendorDetails
   * @param {string} vendorName
   * @param {Object} vendor
   * @returns {Promise<void>}
   */
  async showVTVendorDetails(vendorName, vendor) {
    this.header.displayHeader();

    const icon = this.getVTCompanyIcon(vendor.type);

    let vendorContent = [
      colors.title(`üõ°Ô∏è ${vendorName.toUpperCase()}`),
      colors.muted('‚îÄ'.repeat(40)),
      "",
      colors.success(`${icon} Tipo: ${this.getVTTypeDescription(vendor.type)}`),
      "",
      colors.subtitle("üìß Contatos:"),
      ""
    ];

    if (vendor.contacts && Array.isArray(vendor.contacts)) {
      vendor.contacts.forEach((contactObj, index) => {
        if (contactObj && contactObj.type && contactObj.contact) {
          const contactIcon = contactObj.type === 'email' ? 'üìß' : 'üåê';
          const contactType = contactObj.type === 'email' ? 'E-mail' : 'Formul√°rio';

          const formattedContact = contactObj.type === 'email'
            ? colors.contact(contactObj.contact)
            : colors.link(contactObj.contact);

          vendorContent.push(colors.text(`  ${contactIcon} ${index + 1}. [${contactType}] `) + formattedContact);
        } else {
          console.log(colors.warning(`‚ö†Ô∏è  Contato inv√°lido para ${vendorName}, pulando...`));
        }
      });
    } else {
      vendorContent.push(colors.text("  ‚ö†Ô∏è  Nenhum contato dispon√≠vel"));
    }

    vendorContent.push("");
    vendorContent.push(colors.muted('‚îÄ'.repeat(40)));
    vendorContent.push(colors.highlight2("üí° Inclua o link do relat√≥rio do VirusTotal na sua solicita√ß√£o"));

    const vendorBox = this.boxRenderer.createBox(vendorContent.join("\n"), {
      float: "left",
      padding: 1,
      margin: 1,
      borderColor: "#57f287",
      borderStyle: "round",
      backgroundColor: "#1a1a1a",
      width: Math.min(this.terminalWidth - 8, 70),
      textAlignment: "left",
    });

    console.log(vendorBox);
    console.log("");

    const { action } = await inquirer.prompt([
      {
        type: "list",
        name: "action",
        prefix: "",
        message: colors.highlight2("üéØ O que deseja fazer agora?"),
        choices: MenuRenderer.createVTActionMenu()
      }
    ]);

    switch (action) {
      case "another":
        const vtData = await this.vtLoader.loadData();
        await this.searchVTVendor(vtData.companies);
        break;
      case "back":
        const vtData2 = await this.vtLoader.loadData();
        await this.showVTVendorsList(vtData2.companies);
        break;
      case "menu":
        return;
      case "exit":
        this.showGoodbye();
        process.exit(0);
    }
  }

  /**
   * üè∑Ô∏è Retorna √≠cone baseado no tipo de vendor
   * @method getVTCompanyIcon
   * @param {string} type
   * @returns {string}
   */
  getVTCompanyIcon(type) {
    if (type === "email") return "üìß";
    if (type === "form") return "üåê";
    if (type === "multiple") return "üìã";
    return "üè¢";
  }

  /**
   * üìù Retorna descri√ß√£o do tipo de vendor
   * @method getVTTypeDescription
   * @param {string} type
   * @returns {string}
   */
  getVTTypeDescription(type) {
    if (type === "email") return "E-mail";
    if (type === "form") return "Formul√°rio Online";
    if (type === "multiple") return "M√∫ltiplos Canais";
    return "Contato";
  }

  /**
   * üìÑ Gera arquivo TXT com lista de empresas
   * @async
   * @method generateTxtList
   * @returns {Promise<void>}
   */
  async generateTxtList() {
    this.header.displayHeader();

    console.log(colors.text("üìÑ Preparando para gerar arquivo TXT...\n"));

    try {
      const TxtGenerator = require("../utils/txt-generator");
      const txtGenerator = new TxtGenerator(this.companies);
      const result = txtGenerator.generateTxtFile();

      if (result.success) {
        console.log(colors.success("‚úÖ Arquivo TXT gerado com sucesso!\n"));

        console.log(colors.primary("üìÅ INFORMA√á√ïES DO ARQUIVO"));
        console.log(colors.text("  üìÑ Nome: ") + colors.text(result.fileName));
        console.log(colors.text("  üìÇ Local: ") + colors.link(result.filePath));
        console.log(colors.text("  üíæ Tamanho: ") + colors.text(this.getFileSize(result.filePath) + "\n"));

        console.log(colors.primary("üìä CONTE√öDO INCLU√çDO NO ARQUIVO"));
        console.log(colors.text("  üöÄ ") + colors.description("Cabe√ßalho completo") + colors.text(" - Informa√ß√µes do RavCat"));
        console.log(colors.text("  üè¢ ") + colors.description("Empresas categorizadas") + colors.text(" - Organizadas por tipo de contato"));
        console.log(colors.text("  üìß ") + colors.description("E-mail") + colors.text(" - Empresas com contato por e-mail"));
        console.log(colors.text("  üåê ") + colors.description("Formul√°rio") + colors.text(" - Empresas com formul√°rio online"));
        console.log(colors.text("  üìã ") + colors.description("M√∫ltiplos") + colors.text(" - Empresas com v√°rios canais"));
        console.log(colors.text("  üî§ ") + colors.description("Lista alfab√©tica") + colors.text(" - Todas empresas em ordem A-Z"));
        console.log(colors.text("  üí° ") + colors.description("Informa√ß√µes finais") + colors.text(" - Instru√ß√µes e contatos\n"));

        console.log(colors.highlight2("üí° O arquivo est√° pronto para uso..."));

      } else {
        console.log(colors.error("‚ùå " + "‚ïê".repeat(45)));
        console.log(colors.error("üí• ERRO AO GERAR ARQUIVO"));
        console.log(colors.error("‚ùå " + "‚ïê".repeat(45) + "\n"));

        console.log(colors.text("üìù Detalhes do erro:"));
        console.log(colors.error(`  ${result.error}\n`));

        console.log(colors.info("üîß Solu√ß√µes poss√≠veis:"));
        console.log(colors.text("  ‚Ä¢ Verifique as permiss√µes de escrita no diret√≥rio"));
        console.log(colors.text("  ‚Ä¢ Confirme que h√° espa√ßo em disco dispon√≠vel"));
        console.log(colors.text("  ‚Ä¢ Tente executar como administrador (se necess√°rio)"));
        console.log(colors.text("  ‚Ä¢ Execute manualmente: ") + colors.highlight("npm install") + colors.text(" para verificar depend√™ncias\n"));
      }
    } catch (error) {
      console.log(colors.error(`‚ùå Erro inesperado: ${error.message}\n`));
    }

    await inquirer.prompt([
      {
        type: "input",
        name: "continue",
        message: colors.muted("Pressione Enter para continuar..."),
      },
    ]);
  }

  /**
   * üìè Calcula tamanho do arquivo de forma leg√≠vel
   * @method getFileSize
   * @param {string} filePath
   * @returns {string}
   */
  getFileSize(filePath) {
    try {
      const fs = require('fs');
      const stats = fs.statSync(filePath);
      const bytes = stats.size;

      if (bytes === 0) return '0 Bytes';

      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));

      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    } catch (error) {
      return 'N√£o dispon√≠vel';
    }
  }

  /**
   * üîç Permite buscar empresa por nome
   * @async
   * @method searchCompany
   * @returns {Promise<void>}
   */
  async searchCompany() {
    this.header.displayHeader();

    const { companyName } = await inquirer.prompt([
      {
        type: "input",
        name: "companyName",
        message: colors.title("üîç Digite o nome do servi√ßo/empresa:"),
        validate: (input) => {
          if (input.trim().length === 0) {
            return colors.danger("‚ö†Ô∏è  Por favor, digite um nome v√°lido");
          }
          return true;
        },
      },
    ]);

    const searchTerm = companyName.toLowerCase().trim();
    const foundCompany = this.findCompany(searchTerm);

    if (foundCompany) {
      await this.showCompanyDetails(foundCompany.key);
    } else {
      console.log(colors.error(`\n‚ùå Empresa "${companyName}" n√£o encontrada.`));
      console.log(colors.highlight2("üí° Use a lista completa para ver todas as op√ß√µes dispon√≠veis\n"));

      const { tryAgain } = await inquirer.prompt([
        {
          type: "confirm",
          name: "tryAgain",
          message: colors.title("üîç Deseja tentar outra busca?"),
          default: true,
        },
      ]);

      if (tryAgain) {
        await this.searchCompany();
      }
    }
  }

  /**
   * üîé Encontra empresa baseado no termo de busca
   * @method findCompany
   * @param {string} searchTerm
   * @returns {Object|null}
   */
  findCompany(searchTerm) {
    const companies = Object.keys(this.companies);

    if (this.companies[searchTerm]) {
      return { key: searchTerm, company: this.companies[searchTerm] };
    }

    for (const companyKey of companies) {
      if (companyKey.toLowerCase().includes(searchTerm)) {
        return { key: companyKey, company: this.companies[companyKey] };
      }
    }

    return null;
  }

  /**
   * üìã Mostra lista completa de empresas
   * @async
   * @method showCompaniesList
   * @returns {Promise<void>}
   */
  async showCompaniesList() {
    const companiesList = this.prepareCompaniesList();

    this.header.displayHeader();

    console.log(colors.primary("\nüìã LISTA COMPLETA DE EMPRESAS"));
    console.log(colors.info(`üìä Total: ${companiesList.length} empresas dispon√≠veis\n`));

    const { selectedCompany } = await inquirer.prompt([
      {
        type: "list",
        name: "selectedCompany",
        prefix: "",
        message: colors.highlight2("üéØ Selecione uma empresa:"),
        choices: [
          ...companiesList.map((company, index) => {
            const number = (index + 1).toString().padStart(2, " ");
            return {
              name: `${number}. ${company.icon} ${colors.back(company.name)} - ${colors.muted(company.type)}`,
              value: company.key,
              short: company.name,
            };
          }),
          new inquirer.Separator(),
          {
            name: `${colors.back("üîô")} Voltar`,
            value: "back",
            short: "Voltar",
          }
        ],
        pageSize: Math.min(companiesList.length + 3, 15),
        loop: false,
      },
    ]);

    if (selectedCompany === "back") {
      await this.showCompaniesMenu();
      return;
    }

    await this.showCompanyDetails(selectedCompany);
  }

  /**
   * üìÑ Mostra detalhes completos de uma empresa
   * @async
   * @method showCompanyDetails
   * @param {string} companyKey
   * @returns {Promise<void>}
   */
  async showCompanyDetails(companyKey) {
    const company = this.companies[companyKey];

    this.header.displayHeader();

    const companyCard = this.boxRenderer.createCompanyCard(companyKey, company);
    console.log(companyCard);
    console.log('');

    const { continueAction } = await inquirer.prompt([
      {
        type: "list",
        name: "continueAction",
        prefix: "",
        message: colors.highlight2("üìù O que deseja fazer agora?"),
        choices: MenuRenderer.createActionMenu()
      }
    ]);

    if (continueAction === "another") {
      await this.showCompaniesList();
    } else if (continueAction === "back") {
      await this.showCompaniesList();
    } else if (continueAction === "menu") {
      await this.showCompaniesMenu();
    }
  }

  /**
   * üè≠ Prepara lista de empresas para exibi√ß√£o
   * @method prepareCompaniesList
   * @returns {Array<Object>}
   */
  prepareCompaniesList() {
    return Object.keys(this.companies)
      .sort()
      .map((key) => {
        const company = this.companies[key];
        return {
          key: key,
          name: key,
          icon: this.getCompanyIcon(company),
          type: this.getCompanyDescription(company),
        };
      });
  }

  /**
   * üè∑Ô∏è Retorna √≠cone baseado no tipo de empresa
   * @method getCompanyIcon
   * @param {Object} company
   * @returns {string}
   */
  getCompanyIcon(company) {
    if (company.type === "email") return "üìß";
    if (company.type === "form") return "üåê";
    if (company.type === "multiple") return "üìã";
    return "üè¢";
  }

  /**
   * üìù Retorna descri√ß√£o do tipo de empresa
   * @method getCompanyDescription
   * @param {Object} company
   * @returns {string}
   */
  getCompanyDescription(company) {
    if (company.type === "email") return "E-mail";
    if (company.type === "form") return "Formul√°rio";
    if (company.type === "multiple") return "M√∫ltiplos";
    return "Contato";
  }

  /**
   * ‚ÑπÔ∏è Mostra informa√ß√µes sobre o sistema
   * @async
   * @method showAbout
   * @returns {Promise<void>}
   */
  async showAbout() {
    this.header.displayHeader();
    const bannerText = figlet.textSync("SOBRE", {
      font: "Standard",
      horizontalLayout: "default",
      verticalLayout: "default",
    });

    const aboutContent = [
      "",
      colors.action(bannerText),
      "",
      colors.text("üîç Sistema de Consulta de Contatos"),
      "",
      colors.text("Feito com üíö por ") + colors.primary("RavenaStar"),
      colors.text("üìö Docs: ") + colors.link("https://ravenastar.link"),
      "",
      colors.success("‚ú® Caracter√≠sticas principais:"),
      colors.text("üìß Contatos de e-mail para den√∫ncias"),
      colors.text("üåê Formul√°rios online oficiais"),
      colors.text("üìã M√∫ltiplos canais de contato"),
      colors.text("üõ°Ô∏è  Contatos VirusTotal (falsos positivos)"),
      colors.text("üîÑ Dados atualizados automaticamente"),
    ].join("\n");

    const aboutBox = this.boxRenderer.createBox(aboutContent, {
      float: "left",
      padding: 1,
      margin: 1,
      borderColor: "#57f287",
      borderStyle: "classic",
      backgroundColor: "#1a1a1a",
      width: Math.min(this.terminalWidth - 8, 80),
      textAlignment: "center",
    });

    console.log(aboutBox);
    console.log("");

    await inquirer.prompt([
      {
        type: "input",
        name: "continue",
        message: colors.muted("Pressione Enter para continuar..."),
      },
    ]);
  }

  /**
   * üëã Mostra mensagem de despedida
   * @method showGoodbye
   * @returns {void}
   */
  showGoodbye() {
    const goodbyeContent = [
      colors.primary("üëã Volte sempre!"),
      "",
      colors.text("Lembre-se: Den√∫ncias respons√°veis ajudam a"),
      colors.text("manter a internet mais segura para todos."),
    ].join("\n");

    const goodbyeBox = this.boxRenderer.createBox(goodbyeContent, {
      float: "left",
      padding: 1,
      margin: 1,
      borderColor: "#57f287",
      borderStyle: "classic",
      backgroundColor: "#1a1a1a",
      width: Math.min(this.terminalWidth - 8, 80),
      textAlignment: "center",
    });

    console.log(goodbyeBox);
    console.log("");
  }
}

module.exports = Menu;